<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Expires" content="0">
<script src="jquery-1.12.4.min.js"></script>
<script>
function getUrlParam(name) {
    var m = {};
    var reg = new RegExp("(^|&)" + name + "=([^&]*)", "g");
    var p = window.location.search.substr(1);
    var r = p.match(reg);
    if (r != null) {
        r.forEach(i => {
            var v = unescape(i).substr(i.indexOf("=") + 1);
            console.log(v);
            m[v] = '';
        });
        return m;
    }
    return m;
}
var player = '';
var result = {"0":0, "1":0};
var time = 0;
function getRecord(item, succ, min, x0, x1, y0, y1) {
    if (item[3] == 0 || item[0] != succ || item[4] < min) {
        return '';
    }   
    player = item[1];
    var str = '';
    str += '<br/><div>';
    if (item[0] == '1')
        str += '<img src="img/succ.png" width="35px" height="30px"/>';
    else
        str += '<img src="img/fail.png" width="35px" height="30px"/>';
    var x0has = false;
    for (var j=2; j<7; j++) {
        str += '<img src="img/' + item[5][j] + '.png" width="30px" height="30px"/>';
        if (item[5][j] in x0) {
            x0has = true;
        }
    }
    if (x0has) {
        return '';
    }
    for (var k in x1) {
        var x1has = false;
        for (var j=2; j<7; j++) {
            if (k == item[5][j]) {
                x1has = true;
            }
        }
        if (!x1has) {
            return '';
        }
    }
    str += '<img src="img/vs.png" width="13px" height="17px"/>';
    var y0has = false;
    var y1has = (Object.keys(y1).length == 0) ? true : false;
    for (var j=2; j<7; j++) {
        str += '<img src="img/' + item[6][j] + '.png" width="30px" height="30px"/>';
        if (item[6][j] in y0) {
            y0has = true;
        }
        if (item[6][j] in y1) {
            y1has = true;
        }
    }
    if (y0has || !y1has) {
        return '';
    }
    score = item[4];
    if (score > 3000) {
        score = Math.floor((item[4] - 3000) / 30);
    } else if (score > 18000) {
        score = Math.floor(500 + (item[4] - 18000) / 30);
    } else {
    }
    str += item[2];
    str += '<img src="img/clock.png" width="10px" height="10px"/>' + Math.ceil(item[3] / 60);
    str += '<img src="img/star.png" width="10px" height="10px"/>' + score;
    str += '</div>';
    result[succ] += 1;
    time += item[3];
    return str;
}

$.getJSON("test.txt", "", function(data) {
        var str = '';
        var x0 = getUrlParam('x0');
        var x1 = getUrlParam('x1');
        var y0 = getUrlParam('y0');
        var y1 = getUrlParam('y1');
        for (var i = data.length; i > 0; i--) {
            str += getRecord(data[i - 1], '0', 0, x0, x1, y0, y1);
        }
        for (var i = data.length; i > 0; i--) {
            str += getRecord(data[i - 1], '1', 0, x0, x1, y0, y1);
        }
        var hdr = '<br/><div>id: ' + player + '</div>';
        hdr += '<br/><div>rate: ' + Math.floor(result['1']*100/(result['0']+result['1'])) + '% ';
        hdr += 'time: ' + Math.ceil(time/60/(result['0']+result['1'])) + '</div>';
        document.write(hdr);
        document.write(str);
        console.log('done');
    }
);
</script>

<title>dashen</title>
</head>
test
<body>
</body>

</html>	
